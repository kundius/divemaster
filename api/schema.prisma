generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["omitApi"]
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

generator prismaClassGenerator {
    provider = "prisma-class-generator"
}

model BlogPost {
  id         Int            @id @default(autoincrement()) @db.UnsignedInt
  title      String         @db.VarChar(255)
  longTitle  String?        @db.VarChar(255)
  alias      String         @unique() @db.VarChar(255)
  content    String?        @db.Text
  readTime   String?        @db.VarChar(255)
  metadata   Json?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  imageId    Int?           @db.UnsignedInt
  status     BlogPostStatus @default(draft)
  image      File?          @relation(fields: [imageId], references: [id])
  tags       BlogTagPosts[]

  @@index([imageId])
  @@map("blog_post")
}

model BlogTag {
  id       Int            @id @default(autoincrement()) @db.UnsignedInt
  name     String         @db.VarChar(255)
  alias    String         @unique() @db.VarChar(255)
  metadata Json?
  posts    BlogTagPosts[]

  @@map("blog_tag")
}

model BlogTagPosts {
  blogTagId    Int      @db.UnsignedInt
  blogPostId   Int      @db.UnsignedInt
  blogPost     BlogPost @relation(fields: [blogPostId], references: [id], onDelete: Cascade)
  blogTag      BlogTag  @relation(fields: [blogTagId], references: [id], onDelete: Cascade)

  @@id([blogTagId, blogPostId])
  @@index([blogPostId])
  @@index([blogTagId])
  @@map("blog_tag_posts")
}

model Brand {
  id        Int       @id @default(autoincrement()) @db.UnsignedInt
  remoteId  String?   @db.VarChar(255)
  title     String    @db.VarChar(255)
  products  Product[]

  @@map("brand")
}

model Cart {
  id           String        @id @db.VarChar(36)
  userId       Int?          @unique() @db.UnsignedInt
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  user         User?         @relation(fields: [userId], references: [id])
  cartProducts CartProduct[]

  @@map("cart")
}

model CartProduct {
  id           String                    @id @db.VarChar(36)
  cartId       String                    @db.VarChar(36)
  productId    Int                       @db.UnsignedInt
  quantity     Int                       @default(1) @db.UnsignedInt
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  cart         Cart                      @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product      Product                   @relation(fields: [productId], references: [id], onDelete: Cascade)
  optionValues CartProductOptionValues[]

  @@index([cartId])
  @@index([productId])
  @@map("cart_product")
}

model CartProductOptionValues {
  cartProductId   String      @db.VarChar(36)
  optionValueId   Int         @db.UnsignedInt
  cartProduct     CartProduct @relation(fields: [cartProductId], references: [id], onDelete: Cascade)
  optionValue     OptionValue @relation(fields: [optionValueId], references: [id], onDelete: Cascade)

  @@id([cartProductId, optionValueId])
  @@index([cartProductId])
  @@index([optionValueId])
  @@map("cart_product_option_values")
}

model Category {
  id          Int                   @id @default(autoincrement()) @db.UnsignedInt
  remoteId    String?               @db.VarChar(255)
  title       String                @db.VarChar(255)
  longTitle   String?               @db.VarChar(255)
  alias       String                @unique() @db.VarChar(255)
  rank        Int                   @default(0)
  description String?               @db.Text
  active      Boolean               @default(true)
  imageId     Int?                  @db.UnsignedInt
  parentId    Int?                  @db.UnsignedInt
  image       File?                 @relation(fields: [imageId], references: [id])
  parent      Category?             @relation("children", fields: [parentId], references: [id])
  children    Category[]            @relation("children")
  options     CategoriesOnOptions[]
  products    CategoryProducts[]

  @@index([imageId])
  @@index([parentId])
  @@map("category")
}

model CategoriesOnOptions {
  categoryId  Int      @db.UnsignedInt
  optionId    Int      @db.UnsignedInt
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  option      Option   @relation(fields: [optionId], references: [id], onDelete: Cascade)

  @@id([categoryId, optionId])
  @@index([categoryId])
  @@index([optionId])
  @@map("category_options")
}

model CategoryProducts {
  categoryId  Int      @db.UnsignedInt
  productId   Int      @db.UnsignedInt
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@id([categoryId, productId])
  @@index([categoryId])
  @@index([productId])
  @@map("category_products")
}

model City {
  id       String @id @db.VarChar(36)
  type     String @db.VarChar(255)
  name     String @db.VarChar(255)
  subject  String @db.VarChar(255)
  district String @db.VarChar(255)
  lat      Float  @db.Float
  lon      Float  @db.Float

  @@map("city")
}

model Delivery {
  id           Int             @id @default(autoincrement()) @db.UnsignedInt
  service      DeliveryService
  delivered    Int?            @db.TinyInt
  address      String          @db.VarChar(255)
  recipient    Json?
  orderId      Int             @unique() @db.UnsignedInt
  createdAt    DateTime        @default(now())
  deliveredAt  DateTime        @updatedAt
  order        Order           @relation(fields: [orderId], references: [id])

  @@map("delivery")
}

model File {
  id            Int            @id @default(autoincrement()) @db.UnsignedInt
  file          String         @db.VarChar(255)
  path          String         @db.VarChar(255)
  hash          String         @db.VarChar(255)
  type          String         @db.VarChar(255)
  size          Int
  metadata      String?        @db.LongText
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  blogPost     BlogPost[]
  category      Category[]
  productImage ProductImage[]

  @@map("file")
}

model Offer {
  id           Int                 @id @default(autoincrement()) @db.UnsignedInt
  remoteId     String?             @db.VarChar(255)
  title        String?             @db.VarChar(255)
  price        Int
  rank         Int                 @default(0)
  productId    Int                 @db.UnsignedInt
  product      Product             @relation(fields: [productId], references: [id])
  optionValues OfferOptionValues[]

  @@index([productId])
  @@map("offer")
}

model OfferOptionValues {
  offerId         Int         @db.UnsignedInt
  optionValueId   Int         @db.UnsignedInt
  offer           Offer       @relation(fields: [offerId], references: [id], onDelete: Cascade)
  optionValue     OptionValue @relation(fields: [optionValueId], references: [id], onDelete: Cascade)

  @@id([offerId, optionValueId])
  @@index([offerId])
  @@index([optionValueId])
  @@map("offer_option_values")
}

model Option {
  id         Int                   @id @default(autoincrement()) @db.UnsignedInt
  key        String                @unique() @db.VarChar(255)
  caption    String                @db.VarChar(255)
  type       OptionType
  inFilter   Boolean               @default(false)
  rank       Int                   @default(0)
  categories CategoriesOnOptions[]
  values     OptionValue[]

  @@map("option")
}

model OptionValue {
  id                         Int                       @id @default(autoincrement()) @db.UnsignedInt
  content                    String                    @db.VarChar(255)
  optionId                   Int                       @db.UnsignedInt
  productId                  Int                       @db.UnsignedInt
  rank                       Int                       @default(0)
  properties                 Json?
  cartProductOptionValues    CartProductOptionValues[]
  offerOptionValues          OfferOptionValues[]
  option                     Option                    @relation(fields: [optionId], references: [id])
  product                    Product                   @relation(fields: [productId], references: [id])

  @@index([optionId])
  @@index([productId])
  @@map("option_value")
}

model Order {
  id          Int            @id @default(autoincrement()) @db.UnsignedInt
  hash        String         @unique() @db.VarChar(255)
  cost        Int            @db.UnsignedInt
  composition Json?
  userId      Int?           @db.UnsignedInt
  createdAt   DateTime       @default(now())
  delivery    Delivery?
  user        User?          @relation(fields: [userId], references: [id])
  products    OrderProduct[]
  payment     Payment?

  @@index([userId])
  @@map("order")
}

model OrderProduct {
  id         Int      @id @default(autoincrement()) @db.UnsignedInt
  orderId    Int      @db.UnsignedInt
  productId  Int?     @db.UnsignedInt
  quantity   Int      @db.UnsignedInt
  price      Int      @db.UnsignedInt
  title      String   @db.VarChar(255)
  options    Json?
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product    Product? @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_product")
}

model Payment {
  id         Int            @id @default(autoincrement()) @db.UnsignedInt
  service    PaymentService
  paid       Int?           @db.TinyInt
  link       String?        @db.VarChar(255)
  remoteId   String?        @db.VarChar(255)
  orderId    Int            @unique() @db.UnsignedInt
  createdAt  DateTime       @default(now())
  paidAt     DateTime?      @db.DateTime(0)
  order      Order          @relation(fields: [orderId], references: [id])

  @@map("payment")
}

model PickupPoint {
  id               String          @id @db.VarChar(36)
  name             String          @db.VarChar(255)
  districtName     String          @db.VarChar(255)
  subjectName      String          @db.VarChar(255)
  cityType         String          @db.VarChar(255)
  cityName         String          @db.VarChar(255)
  fullAddress      String          @db.VarChar(255)
  shortAddress     String          @db.VarChar(255)
  phone            String?         @db.VarChar(255)
  email            String?         @db.VarChar(255)
  workTime         String          @db.VarChar(255)
  lat              Float           @db.Float
  lon              Float           @db.Float
  note             String?         @db.VarChar(255)
  isReception      Boolean         @default(false)
  isDressingRoom   Boolean         @default(false)
  allowedCod       Boolean         @default(false)
  haveCash         Boolean         @default(false)
  haveCashless     Boolean         @default(false)
  type             PickupPointType

  @@map("pickup_point")
}

model Product {
  id             Int                @id @default(autoincrement()) @db.UnsignedInt
  remoteId       String?            @db.VarChar(255)
  title          String             @db.VarChar(255)
  longTitle      String?            @db.VarChar(255)
  alias          String             @unique() @db.VarChar(255)
  sku            String?            @db.VarChar(255)
  rank           Int                @default(0)
  priceDecrease  Int?
  description    String?            @db.Text
  specifications String?            @db.Text
  exploitation   String?            @db.Text
  active         Boolean            @default(true)
  inStock        Boolean            @default(true)
  recent         Boolean            @default(false)
  favorite       Boolean            @default(false)
  brandId        Int?               @db.UnsignedInt
  cartProducts   CartProduct[]
  categories     CategoryProducts[]
  offers         Offer[]
  optionValues   OptionValue[]
  orderProducts  OrderProduct[]
  brand          Brand?             @relation(fields: [brandId], references: [id])
  images         ProductImage[]

  @@index([brandId])
  @@map("product")
}

model ProductImage {
  fileId     Int     @db.UnsignedInt
  productId  Int     @db.UnsignedInt
  rank       Int     @default(0)
  active     Boolean @default(true)
  file       File    @relation(fields: [fileId], references: [id])
  product    Product @relation(fields: [productId], references: [id])

  @@id([fileId, productId])
  @@index([fileId])
  @@index([productId])
  @@map("product_image")
}

model Role {
  id    Int    @id @default(autoincrement()) @db.UnsignedInt
  title String @unique() @db.VarChar(255)
  scope Json?
  user  User[]

  @@map("role")
}

model User {
  id       Int     @id @default(autoincrement()) @db.UnsignedInt
  email    String  @unique() @db.VarChar(255)
  name     String  @db.VarChar(255)
  password String  @db.VarChar(255)
  active   Boolean @default(true)
  discount Int     @default(0)
  roleId   Int     @db.UnsignedInt
  cart     Cart?
  order    Order[]
  role     Role    @relation(fields: [roleId], references: [id])

  @@index([roleId])
  @@map("user")
}

enum DeliveryService {
  Pickup
  Shipping
}

enum PaymentService {
  Yookassa
  UponCash
}

enum OptionType {
  combo_boolean @map("combo-boolean")
  combo_colors  @map("combo-colors")
  combo_options @map("combo-options")
  numberfield
  textfield
}

enum BlogPostStatus {
  published
  draft
  archived
}

enum PickupPointType {
  cdek
  store
}
